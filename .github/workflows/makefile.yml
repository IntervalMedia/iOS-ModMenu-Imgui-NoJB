name: Makefile CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install Theos
      run: |
        sudo apt-get update
        sudo apt-get install -y autoconf bash curl openssl
        bash -c "$(curl -fsSL "https://raw.githubusercontent.com/theos/theos/master/bin/install-theos")"

    # - name: Download iOS SDK
    #   run: |
    #     mkdir -p $THEOS/sdks
    #     curl -L https://github.com/theos/sdks/archive/refs/heads/master.zip -o sdks.zip
    #     unzip sdks.zip -d $THEOS/sdks
    #     mv $THEOS/sdks/sdks-master/iPhoneOS16.5.sdk $THEOS/sdks/
    #     rm -rf $THEOS/sdks/sdks-master sdks.zip

    - name: Set THEOS_MAKE_PATH
      run: echo "THEOS_MAKE_PATH set to ${THEOS}/makefiles"
      env:
        THEOS: /path/to/theos

    - name: Build the tweak from TheosMMTempKomaru folder
      run: make package
      working-directory: ./TheosMMTempKomaru
